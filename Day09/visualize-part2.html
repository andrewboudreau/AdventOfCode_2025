<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 9 Part 2: Movie Theater - Polygon Rectangle Search</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #1a1a2e;
            color: #eee;
            font-family: 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        h1 {
            color: #ffd700;
            margin-bottom: 5px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        .subtitle {
            color: #888;
            margin-bottom: 15px;
            font-size: 14px;
        }
        .stats {
            display: flex;
            gap: 30px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        .stat {
            text-align: center;
        }
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #4ecdc4;
        }
        .stat-value.best { color: #ffd700; }
        .stat-value.invalid { color: #ff6b6b; }
        .stat-value.valid { color: #4ade80; }
        .stat-label {
            color: #888;
            font-size: 11px;
        }
        #canvas {
            border: 2px solid #333;
            border-radius: 8px;
            background: #0f0f1a;
        }
        .controls {
            margin-top: 15px;
            display: flex;
            gap: 15px;
            align-items: center;
        }
        button {
            background: #4ecdc4;
            color: #1a1a2e;
            border: none;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }
        button:hover {
            background: #45b7aa;
            transform: scale(1.05);
        }
        button:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
        }
        .speed-control {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }
        input[type="range"] { width: 100px; }
        .legend {
            margin-top: 12px;
            display: flex;
            gap: 20px;
            font-size: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        .legend-rect {
            width: 16px;
            height: 10px;
            border: 2px solid;
        }
        .final-answer {
            margin-top: 15px;
            padding: 12px 25px;
            background: linear-gradient(135deg, #4ade80, #ffd700);
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            color: #1a1a2e;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Day 9 Part 2: Movie Theater</h1>
    <p class="subtitle">Finding largest rectangle inside the red/green polygon</p>

    <div class="stats">
        <div class="stat">
            <div class="stat-value" id="pairsChecked">0</div>
            <div class="stat-label">Pairs Checked</div>
        </div>
        <div class="stat">
            <div class="stat-value valid" id="validCount">0</div>
            <div class="stat-label">Valid Rectangles</div>
        </div>
        <div class="stat">
            <div class="stat-value invalid" id="invalidCount">0</div>
            <div class="stat-label">Invalid (Outside)</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="currentArea">0</div>
            <div class="stat-label">Current Area</div>
        </div>
        <div class="stat">
            <div class="stat-value best" id="bestArea">0</div>
            <div class="stat-label">Best Area</div>
        </div>
    </div>

    <canvas id="canvas" width="900" height="700"></canvas>

    <div class="controls">
        <button id="startBtn">Start Animation</button>
        <button id="skipBtn">Skip to End</button>
        <div class="speed-control">
            <span>Speed:</span>
            <input type="range" id="speed" min="1" max="100" value="50">
        </div>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-dot" style="background: #ff4444;"></div>
            <span>Red Tiles (Vertices)</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background: rgba(74, 222, 128, 0.6);"></div>
            <span>Polygon Interior</span>
        </div>
        <div class="legend-item">
            <div class="legend-rect" style="border-color: #ff6b6b; background: rgba(255,107,107,0.2);"></div>
            <span>Invalid Rectangle</span>
        </div>
        <div class="legend-item">
            <div class="legend-rect" style="border-color: #4ade80; background: rgba(74,222,128,0.3);"></div>
            <span>Valid Rectangle</span>
        </div>
        <div class="legend-item">
            <div class="legend-rect" style="border-color: #ffd700; background: rgba(255,215,0,0.3);"></div>
            <span>Best Rectangle</span>
        </div>
    </div>

    <div class="final-answer" id="finalAnswer"></div>

    <script>
const TILES_RAW = `98154,50433
98154,51659
98318,51659
98318,52839
97531,52839
97531,54072
97795,54072
97795,55273
97599,55273
97599,56438
97163,56438
97163,57630
96985,57630
96985,58862
97008,58862
97008,60001
96540,60001
96540,61238
96525,61238
96525,62389
96136,62389
96136,63729
96399,63729
96399,64863
95924,64863
95924,66096
95742,66096
95742,67229
95265,67229
95265,68026
93975,68026
93975,69483
94298,69483
94298,70437
93447,70437
93447,71702
93255,71702
93255,72471
92092,72471
92092,73807
91997,73807
91997,74541
90844,74541
90844,75747
90491,75747
90491,76890
90014,76890
90014,77857
89265,77857
89265,78572
88186,78572
88186,79561
87489,79561
87489,80961
87282,80961
87282,81285
85786,81285
85786,82279
85089,82279
85089,83598
84715,83598
84715,84056
83449,84056
83449,85206
82869,85206
82869,85762
81730,85762
81730,86992
81183,86992
81183,87726
80201,87726
80201,88040
78902,88040
78902,89210
78253,89210
78253,89823
77189,89823
77189,90009
75855,90009
75855,90815
74933,90815
74933,91606
73991,91606
73991,92411
73044,92411
73044,92934
71938,92934
71938,93433
70822,93433
70822,93648
69581,93648
69581,94314
68546,94314
68546,95024
67517,95024
67517,94716
66105,94716
66105,95285
65025,95285
65025,96388
64097,96388
64097,96208
62773,96208
62773,96508
61596,96508
61596,96717
60399,96717
60399,96734
59166,96734
59166,97217
58025,97217
58025,97725
56872,97725
56872,97536
55620,97536
55620,97385
54388,97385
54388,97698
53201,97698
53201,97956
51999,97956
51999,98476
50792,98476
50792,97657
49571,97657
49571,97890
48355,97890
48355,98145
47124,98145
47124,98316
45883,98316
45883,97952
44687,97952
44687,97958
43453,97958
43453,97033
42361,97033
42361,96816
41173,96816
41173,97033
39892,97033
39892,96956
38657,96956
38657,96441
37528,96441
37528,96130
36350,96130
36350,95671
35217,95671
35217,95273
34069,95273
34069,95070
32845,95070
32845,94644
31699,94644
31699,93613
30817,93613
30817,93489
29542,93489
29542,93176
28337,93176
28337,92481
27321,92481
27321,91694
26364,91694
26364,90870
25443,90870
25443,90230
24418,90230
24418,89472
23473,89472
23473,88942
22372,88942
22372,88622
21100,88622
21100,87565
20378,87565
20378,86615
19591,86615
19591,86172
18377,86172
18377,85663
17192,85663
17192,84787
16331,84787
16331,83324
16070,83324
16070,82800
14866,82800
14866,82182
13727,82182
13727,80646
13644,80646
13644,80193
12282,80193
12282,79304
11429,79304
11429,78018
11116,78018
11116,77212
10142,77212
10142,75913
9901,75913
9901,74888
9258,74888
9258,74205
8022,74205
8022,73085
7511,73085
7511,71792
7349,71792
7349,70816
6580,70816
6580,69681
6128,69681
6128,68714
5284,68714
5284,67466
5106,67466
5106,66359
4578,66359
4578,65036
4680,65036
4680,63974
4016,63974
4016,62754
3859,62754
3859,61611
3430,61611
3430,60462
2997,60462
2997,59180
3198,59180
3198,57968
3115,57968
3115,56786
2871,56786
2871,55659
2129,55659
2129,54386
2631,54386
2631,53203
2260,53203
2260,51991
2244,51991
2244,50781
2169,50781
2169,50401
94699,50401
94699,48346
1840,48346
1840,47122
1834,47122
1834,45904
1930,45904
1930,44738
2511,44738
2511,43572
2915,43572
2915,42343
2857,42343
2857,41166
3146,41166
3146,39955
3257,39955
3257,38776
3536,38776
3536,37554
3652,37554
3652,36292
3674,36292
3674,35141
4091,35141
4091,33976
4464,33976
4464,32898
5069,32898
5069,31972
6021,31972
6021,30493
5649,30493
5649,29455
6326,29455
6326,28642
7432,28642
7432,27428
7720,27428
7720,26421
8405,26421
8405,25199
8722,25199
8722,24020
9143,24020
9143,23327
10310,23327
10310,21943
10453,21943
10453,21244
11568,21244
11568,20019
11979,20019
11979,19219
12936,19219
12936,18221
13648,18221
13648,17813
15012,17813
15012,16324
15205,16324
15205,16070
16674,16070
16674,14784
17123,14784
17123,14187
18224,14187
18224,13164
18948,13164
18948,12901
20301,12901
20301,12140
21235,12140
21235,10741
21711,10741
21711,10344
22925,10344
22925,10007
24155,10007
24155,9447
25226,9447
25226,8483
26060,8483
26060,8154
27263,8154
27263,7684
28378,7684
28378,6350
29073,6350
29073,6326
30407,6326
30407,6127
31638,6127
31638,4808
32417,4808
32417,5034
33804,5034
33804,4750
34986,4750
34986,4343
36124,4343
36124,3377
37112,3377
37112,3398
38380,3398
38380,3461
39640,3461
39640,3182
40816,3182
40816,2907
41995,2907
41995,2161
43111,2161
43111,2019
44327,2019
44327,2137
45567,2137
45567,2347
46801,2347
46801,2084
48001,2084
48001,1828
49212,1828
49212,2439
50427,2439
50427,2250
51639,2250
51639,2565
52833,2565
52833,2148
54077,2148
54077,2164
55299,2164
55299,2738
56451,2738
56451,2802
57665,2802
57665,3238
58815,3238
58815,2830
60136,2830
60136,3636
61199,3636
61199,3429
62505,3429
62505,3635
63718,3635
63718,4523
64718,4523
64718,5061
65813,5061
65813,5459
66953,5459
66953,5293
68325,5293
68325,6415
69169,6415
69169,6668
70383,6668
70383,6681
71733,6681
71733,7882
72484,7882
72484,7927
73849,7927
73849,8994
74637,8994
74637,9180
75955,9180
75955,10353
76643,10353
76643,10757
77840,10757
77840,11923
78490,11923
78490,12448
79611,12448
79611,13185
80573,13185
80573,13529
81882,13529
81882,14572
82591,14572
82591,15742
83155,15742
83155,16606
83999,16606
83999,17071
85270,17071
85270,18173
85870,18173
85870,19222
86510,19222
86510,20214
87207,20214
87207,21071
88074,21071
88074,22170
88622,22170
88622,22934
89641,22934
89641,23738
90637,23738
90637,24863
91147,24863
91147,25941
91723,25941
91723,26996
92336,26996
92336,28213
92638,28213
92638,29042
93713,29042
93713,30301
93909,30301
93909,31451
94317,31451
94317,32685
94502,32685
94502,33573
95609,33573
95609,34821
95747,34821
95747,36122
95663,36122
95663,37280
96014,37280
96014,38330
96801,38330
96801,39562
96891,39562
96891,40803
96883,40803
96883,42002
97055,42002
97055,43148
97578,43148
97578,44409
97285,44409
97285,45554
97999,45554
97999,46811
97513,46811
97513,48015
97582,48015
97582,49215
98001,49215
98001,50433`;

// Parse tiles
const tiles = TILES_RAW.trim().split('\n').map(line => {
    const [x, y] = line.split(',').map(Number);
    return { x, y };
});

// Coordinate compression
const xs = [...new Set(tiles.map(t => t.x))].sort((a, b) => a - b);
const ys = [...new Set(tiles.map(t => t.y))].sort((a, b) => a - b);
const xIndex = new Map(xs.map((x, i) => [x, i]));
const yIndex = new Map(ys.map((y, i) => [y, i]));

const cellsX = xs.length - 1;
const cellsY = ys.length - 1;
const isInside = Array.from({ length: cellsX }, () => Array(cellsY).fill(false));

// Build vertical edges
const verticalEdges = [];
for (let i = 0; i < tiles.length; i++) {
    const t1 = tiles[i];
    const t2 = tiles[(i + 1) % tiles.length];
    if (t1.x === t2.x) {
        verticalEdges.push({ x: t1.x, yMin: Math.min(t1.y, t2.y), yMax: Math.max(t1.y, t2.y) });
    }
}

// Mark inside cells using scanline
for (let j = 0; j < cellsY; j++) {
    const yMid = (ys[j] + ys[j + 1]) / 2;
    const crossings = verticalEdges
        .filter(e => e.yMin < yMid && yMid < e.yMax)
        .map(e => e.x)
        .sort((a, b) => a - b);

    for (let k = 0; k < crossings.length - 1; k += 2) {
        const x1 = crossings[k];
        const x2 = crossings[k + 1];
        const i1 = xIndex.get(x1);
        const i2 = xIndex.get(x2);
        for (let ii = i1; ii < i2; ii++) {
            isInside[ii][j] = true;
        }
    }
}

// Pre-compute all pairs with validity
const pairs = [];
for (let a = 0; a < tiles.length; a++) {
    for (let b = a + 1; b < tiles.length; b++) {
        const minX = Math.min(tiles[a].x, tiles[b].x);
        const maxX = Math.max(tiles[a].x, tiles[b].x);
        const minY = Math.min(tiles[a].y, tiles[b].y);
        const maxY = Math.max(tiles[a].y, tiles[b].y);

        const iMin = xIndex.get(minX);
        const iMax = xIndex.get(maxX);
        const jMin = yIndex.get(minY);
        const jMax = yIndex.get(maxY);

        let valid = true;
        for (let i = iMin; i < iMax && valid; i++) {
            for (let j = jMin; j < jMax && valid; j++) {
                if (!isInside[i][j]) valid = false;
            }
        }

        const width = maxX - minX + 1;
        const height = maxY - minY + 1;
        const area = width * height;

        pairs.push({ a, b, minX, maxX, minY, maxY, valid, area });
    }
}

// Canvas setup
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const padding = 40;

const minXCoord = Math.min(...tiles.map(t => t.x));
const maxXCoord = Math.max(...tiles.map(t => t.x));
const minYCoord = Math.min(...tiles.map(t => t.y));
const maxYCoord = Math.max(...tiles.map(t => t.y));

const scaleX = (canvas.width - 2 * padding) / (maxXCoord - minXCoord);
const scaleY = (canvas.height - 2 * padding) / (maxYCoord - minYCoord);
const scale = Math.min(scaleX, scaleY);

function toCanvas(x, y) {
    return {
        x: padding + (x - minXCoord) * scale,
        y: padding + (y - minYCoord) * scale
    };
}

// Animation state
let currentPairIndex = 0;
let bestArea = 0;
let bestPair = null;
let validCount = 0;
let invalidCount = 0;
let animating = false;
let animationId = null;

// DOM elements
const pairsCheckedEl = document.getElementById('pairsChecked');
const validCountEl = document.getElementById('validCount');
const invalidCountEl = document.getElementById('invalidCount');
const currentAreaEl = document.getElementById('currentArea');
const bestAreaEl = document.getElementById('bestArea');
const startBtn = document.getElementById('startBtn');
const skipBtn = document.getElementById('skipBtn');
const speedSlider = document.getElementById('speed');
const finalAnswerEl = document.getElementById('finalAnswer');

function drawPolygonInterior() {
    // Draw filled cells
    ctx.fillStyle = 'rgba(74, 222, 128, 0.15)';
    for (let i = 0; i < cellsX; i++) {
        for (let j = 0; j < cellsY; j++) {
            if (isInside[i][j]) {
                const p1 = toCanvas(xs[i], ys[j]);
                const p2 = toCanvas(xs[i + 1], ys[j + 1]);
                ctx.fillRect(p1.x, p1.y, p2.x - p1.x, p2.y - p1.y);
            }
        }
    }
}

function drawPolygonEdges() {
    ctx.strokeStyle = '#4ade80';
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    const start = toCanvas(tiles[0].x, tiles[0].y);
    ctx.moveTo(start.x, start.y);
    for (let i = 1; i <= tiles.length; i++) {
        const t = tiles[i % tiles.length];
        const p = toCanvas(t.x, t.y);
        ctx.lineTo(p.x, p.y);
    }
    ctx.stroke();
}

function drawTiles() {
    tiles.forEach(tile => {
        const pos = toCanvas(tile.x, tile.y);
        ctx.beginPath();
        ctx.arc(pos.x, pos.y, 3, 0, Math.PI * 2);
        ctx.fillStyle = '#ff4444';
        ctx.fill();
    });
}

function drawRectangle(pair, color, fillColor) {
    const p1 = toCanvas(pair.minX, pair.minY);
    const p2 = toCanvas(pair.maxX, pair.maxY);

    ctx.fillStyle = fillColor;
    ctx.fillRect(p1.x, p1.y, p2.x - p1.x, p2.y - p1.y);

    ctx.strokeStyle = color;
    ctx.lineWidth = 2;
    ctx.strokeRect(p1.x, p1.y, p2.x - p1.x, p2.y - p1.y);

    // Highlight corners
    [pair.a, pair.b].forEach(idx => {
        const tile = tiles[idx];
        const pos = toCanvas(tile.x, tile.y);
        ctx.beginPath();
        ctx.arc(pos.x, pos.y, 5, 0, Math.PI * 2);
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        ctx.stroke();
    });
}

function render(currentPair = null) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw polygon interior and edges
    drawPolygonInterior();
    drawPolygonEdges();

    // Draw best rectangle
    if (bestPair) {
        drawRectangle(bestPair, '#ffd700', 'rgba(255, 215, 0, 0.25)');
    }

    // Draw current rectangle
    if (currentPair) {
        if (currentPair.valid) {
            drawRectangle(currentPair, '#4ade80', 'rgba(74, 222, 128, 0.2)');
        } else {
            drawRectangle(currentPair, '#ff6b6b', 'rgba(255, 107, 107, 0.15)');
        }
    }

    // Draw tiles on top
    drawTiles();
}

function updateStats(currentPair = null) {
    pairsCheckedEl.textContent = currentPairIndex.toLocaleString();
    validCountEl.textContent = validCount.toLocaleString();
    invalidCountEl.textContent = invalidCount.toLocaleString();
    if (currentPair) {
        currentAreaEl.textContent = currentPair.area.toLocaleString();
    }
    bestAreaEl.textContent = bestArea.toLocaleString();
}

function animate() {
    if (!animating || currentPairIndex >= pairs.length) {
        if (currentPairIndex >= pairs.length) {
            finishAnimation();
        }
        return;
    }

    const speed = parseInt(speedSlider.value);
    const pairsPerFrame = Math.max(1, Math.floor(speed * speed / 10));

    let lastPair = null;
    for (let i = 0; i < pairsPerFrame && currentPairIndex < pairs.length; i++) {
        const pair = pairs[currentPairIndex];
        if (pair.valid) {
            validCount++;
            if (pair.area > bestArea) {
                bestArea = pair.area;
                bestPair = pair;
            }
        } else {
            invalidCount++;
        }
        lastPair = pair;
        currentPairIndex++;
    }

    updateStats(lastPair);
    render(lastPair);

    animationId = requestAnimationFrame(animate);
}

function finishAnimation() {
    animating = false;
    startBtn.textContent = 'Restart';
    startBtn.disabled = false;
    skipBtn.disabled = true;

    finalAnswerEl.style.display = 'block';
    finalAnswerEl.textContent = `Part 2 Answer: ${bestArea.toLocaleString()}`;

    render();
}

function skipToEnd() {
    for (; currentPairIndex < pairs.length; currentPairIndex++) {
        const pair = pairs[currentPairIndex];
        if (pair.valid) {
            validCount++;
            if (pair.area > bestArea) {
                bestArea = pair.area;
                bestPair = pair;
            }
        } else {
            invalidCount++;
        }
    }

    updateStats();
    finishAnimation();
}

startBtn.addEventListener('click', () => {
    if (animating) return;

    if (currentPairIndex >= pairs.length) {
        currentPairIndex = 0;
        bestArea = 0;
        bestPair = null;
        validCount = 0;
        invalidCount = 0;
        finalAnswerEl.style.display = 'none';
    }

    animating = true;
    startBtn.disabled = true;
    skipBtn.disabled = false;
    animate();
});

skipBtn.addEventListener('click', () => {
    if (animating) {
        cancelAnimationFrame(animationId);
    }
    skipToEnd();
});

// Initial render
render();
updateStats();
    </script>
</body>
</html>
