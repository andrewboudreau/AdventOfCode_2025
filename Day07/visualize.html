<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 07 - Tachyon Beam Splitter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #0a0a0f;
            color: #e0e0e0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        h1 {
            color: #00ffcc;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00ffcc44;
        }
        .subtitle {
            color: #666;
            margin-bottom: 20px;
        }
        #canvas {
            border: 1px solid #333;
            background: #000;
        }
        .controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            background: #1a1a2e;
            color: #00ffcc;
            border: 1px solid #00ffcc44;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 14px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        button:hover {
            background: #00ffcc22;
            border-color: #00ffcc;
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .slider-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        input[type="range"] {
            width: 120px;
            accent-color: #00ffcc;
        }
        .stats {
            margin-top: 15px;
            font-family: monospace;
            color: #888;
            display: flex;
            gap: 30px;
        }
        .stat-value {
            color: #00ffcc;
        }
    </style>
</head>
<body>
    <h1>Tachyon Beam Splitter</h1>
    <p class="subtitle">Advent of Code 2025 - Day 7</p>

    <canvas id="canvas"></canvas>

    <div class="controls">
        <button id="playPause">Play</button>
        <button id="step">Step</button>
        <button id="reset">Reset</button>
        <div class="slider-group">
            <label>Speed:</label>
            <input type="range" id="speed" min="1" max="100" value="30">
        </div>
        <div class="slider-group">
            <label>Scale:</label>
            <input type="range" id="scale" min="2" max="10" value="5">
        </div>
    </div>

    <div class="stats">
        <div>Step: <span id="stepCount" class="stat-value">0</span></div>
        <div>Active Beams: <span id="beamCount" class="stat-value">0</span></div>
        <div>Splitters Hit: <span id="splitCount" class="stat-value">0</span></div>
    </div>

    <script>
// Grid data (embedded from problem.txt)
const GRID_RAW = `
......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^.^.^....................................................................
.............................................................................................................................................
...................................................................^.^.^.^...................................................................
.............................................................................................................................................
..................................................................^.^.^...^..................................................................
.............................................................................................................................................
.................................................................^.^.^.^.^.^.................................................................
.............................................................................................................................................
................................................................^.....^.^.^.^................................................................
.............................................................................................................................................
...............................................................^...^.^...^.^.^...............................................................
.............................................................................................................................................
..............................................................^.^.^.^...^.^.^.^..............................................................
.............................................................................................................................................
.............................................................^.^.^.^.^.^.^.^.^.^.............................................................
.............................................................................................................................................
............................................................^.^.^.^.^.^...^.^...^............................................................
.............................................................................................................................................
...........................................................^.^.^.^...^.^.^...^.^.^...........................................................
.............................................................................................................................................
..........................................................^.^.^...^.^.^.....^.^.^.^..........................................................
.............................................................................................................................................
.........................................................^.^...^...^.^.^.^...^.....^.........................................................
.............................................................................................................................................
........................................................^.....^.^.^...^.^.^.^.^.^.^.^........................................................
.............................................................................................................................................
.......................................................^.^...^.....^.......^.^.^.^...^.......................................................
.............................................................................................................................................
......................................................^.....^...^.^.^.^...^...^.^...^.^......................................................
.............................................................................................................................................
.....................................................^.^.^.^.^.^.^.^.^.....^.^.^.^...^.^.....................................................
.............................................................................................................................................
....................................................^.^.^.^...^.^...^.^.^...^...^.^.^.^.^....................................................
.............................................................................................................................................
...................................................^.....^.^.....^.^.^.^.....^.^.^.^.^.^.^...................................................
.............................................................................................................................................
..................................................^.^.^.^.^.^.^.......^...^.^.^.^.^.^.^.^.^..................................................
.............................................................................................................................................
.................................................^.....^...^.^.^.^.^...^.^.^.^.^.......^.^.^.................................................
.............................................................................................................................................
................................................^.^.^.....^.^.^.^.^.^.^.^.^.^.^.....^...^.^.^................................................
.............................................................................................................................................
...............................................^.^...^.^...^...^.^...^.^...^.^.^.^.^.^...^.^.^...............................................
.............................................................................................................................................
..............................................^.^.^.^...^.^.^.........^.^.^...^.^...^.^...^.^.^..............................................
.............................................................................................................................................
.............................................^.....^.^.^...^.^.^.^...^.^.^.^.^.^.^.^.^...^.^.^.^.............................................
.............................................................................................................................................
............................................^...^.....^.^.....^...^.^...^.^.^...^.^.^.^.^.^.^...^............................................
.............................................................................................................................................
...........................................^...^.^...^.^.^.^...^.^.......^.......^.^...^.^...^...^...........................................
.............................................................................................................................................
..........................................^.^.^.^.^.^.^.....^...^.^...^.^...^...^.....^...^...^...^..........................................
.............................................................................................................................................
.........................................^.^.^...^...^.^.....^.^...^.^.^...^...^.....^.^.^.^.....^.^.........................................
.............................................................................................................................................
........................................^.^...^...^.^.^...^.^...^.^...^.^.....^.^.^.^.^.^.....^.^...^........................................
.............................................................................................................................................
.......................................^.^.^.^.^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^...^.^.......................................
.............................................................................................................................................
......................................^.^.^.^.^.^...^.^.^.^...^.^.^...^.^.^...^...^.^.^.^...^.^.^.^.^.^......................................
.............................................................................................................................................
.....................................^.^.^.^.^.^.^.........^.....^.^.....^.^.....^.^.^.^.^...^...^...^.^.....................................
.............................................................................................................................................
....................................^.^...^.........^.^.^.^.^.^...^.^.....^.^.....^...^.^...^.^...^...^.^....................................
.............................................................................................................................................
...................................^.^.^...^...^.^.^.^.^.^.^...^.^.^.^...^.^.^.^.....^.^.^.^.^...^...^.^.^...................................
.............................................................................................................................................
..................................^.....^.^.^.^.......^.....^.^.^.^.^.....^...^.^.^.....^.^.....^.^...^...^..................................
.............................................................................................................................................
.................................^...^.^.....^...^.^...^...^.^.....^...^.^.^.....^.^.......^.^.^.^.^.^...^.^.................................
.............................................................................................................................................
................................^.^.^.^.^.^...^.^.^.^.^.^...^...^.^.^.^...^.^...^.^.....^.^.^.....^.^...^.^.^................................
.............................................................................................................................................
...............................^.^.^.^.^.^.....^.^...^.^.^.^...^.^.^.^.^.^.^.^...^.^...^.^.^.^.^.......^.^.^.^...............................
.............................................................................................................................................
..............................^.^...^.^.......^...^...^.^...^.^.^.^.^...^.^.^.^.^.^.....^.^.^...^.......^...^.^..............................
.............................................................................................................................................
.............................^.^...^...^...^.^...^.^.^.^.....^.^.^.....^...^...^.......^...^.^.^.^.^.^.^.......^.............................
.............................................................................................................................................
............................^.^.^...^...^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.......^.^.^.^.^.^.^.^.^.^.^.^.^.^............................
.............................................................................................................................................
...........................^.^...^.^.^.......^.^.....^.^.^...^.....^.^.^.....^.^.^.^.^.^.^.^...^.^.^.^.....^.^.^.^...........................
.............................................................................................................................................
..........................^.^.^.^.....^.^.....^.^.^.^.^.^.^...^.....^.^.^.^.^...^.^.^.^.^.....^.^...^.^...^...^.^.^..........................
.............................................................................................................................................
.........................^.^.^.^.^.^.^.^...^.^...^.^...^.^.^.......^.^.^.^.^.^.^.^.^...^.^.....^.^.^.^.^.^.^.^.....^.........................
.............................................................................................................................................
........................^.^.^.^.^...^.^.^.^.^.^.^...^.^...^.^.....^.^.^.^.^.^.^.^.....^.....^...^.^.......^.^.^.^.^.^........................
.............................................................................................................................................
.......................^...^.......^.......^.^...^.^.^.^...^.^.....^.^.^...^.^.^...^...^.^...^.^.^.^...^.^...^.^.^.^.^.......................
.............................................................................................................................................
......................^.^.^.^.....^...^.^.^...^.^.^...^.^.^.^.^.^.^...^...^.^.^.^.^.^...^.^.^...^...^.^.^.^.^...^.^.^.^......................
.............................................................................................................................................
.....................^.^.^.^.^.^...^.^.^...^.^.^...^...^.^.^.^.^.^...^...^.^.^.^...^...^...^...^.^.^.^...^.^.^.....^.^.^.....................
.............................................................................................................................................
....................^.^.^.^...^.......^...^.^...^...^.^.^.^...^.^.^.^.^.^.^.^.^...^...^.^.^.^.^.^.^.^.^.^.....^.^.^.^.^.^....................
.............................................................................................................................................
...................^.^.^...^.^.....^.^.^.^...^.^.^.^.^.^.....^.....^.......^.....^...^.....^...^.^...^.......^.^...^.^.^.^...................
.............................................................................................................................................
..................^.^.^...^.^...^.^.^.^...^.^.^...^.^.^...^.^.^.^.^.^...^.^...^.^.^...^.^.^.^.^.^.^.^.......^.....^.^.^...^..................
.............................................................................................................................................
.................^...^.^...^...^...^.^.^.^.^.^.^.^.^.^.^.^.......^.^.^...^.^.^.^.^...^.^.^...^.^.^.^.^...^...^.^...^.......^.................
.............................................................................................................................................
................^.^.^.^...^...^.^...^.^.^...^.^...^...^.^.^...^.^.^.^...^.....^.^.^...^.^...^.^.^.^...^.^.^...^.^.....^...^.^................
.............................................................................................................................................
...............^.^.^.......^.^.^.^.^...^...^.^...^.^...^.^.^.^.^...^.^.^.^.^.^.^.^.^...^.^.^...^...^...^...^.^...^.^.^.^.^.^.^...............
.............................................................................................................................................
..............^.^.^.^.^...^.^.^.....^.^...^.^.^.^.^.^.^.^.^.^.^...^.^.^...^.^.^.^.^...^...^.^.^.....^.^.^.....^...^.^.^...^.^.^..............
.............................................................................................................................................
.............^...^.....^.^...^.^...^.^...^.^.^.^.^.......^.^.^.^.^...^.^.^...^.^.^.....^.^...^.^.^.^.....^.^.^.^.^...^.^.^.^.^.^.............
.............................................................................................................................................
............^.^...^.......^...^.^.^.^.^.^.^...^.^.^.^.^.^...^...^.^.^.^.....^...^...^...^.^.^.^.^...^.^.^...^.^...^.^.^.^.^...^.^............
.............................................................................................................................................
...........^.....^.^.^.^...^.^.^...^...^...^.^.^.......^.....^.^.^.^...^.^.^...^...^.^.^...^...^.....^.^.^.^.^...^...^.^.^.^.^.^.^...........
.............................................................................................................................................
..........^.....^.^.^.^...^.^.^...^.^...^.....^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^...^.^.^.^.^...^.^.^.^.^.^.^.^...^.^.^.^..........
.............................................................................................................................................
.........^.^.^.^.^.^...^.^.^...^.^.^...^.....^...^.^.^.........^.^...^.^.....^.^.^.^.^.^.^.^.......^.^.^.^.^.^.......^.^.^.^.^...^.^.........
.............................................................................................................................................
........^.....^.^...^.^.^...^.^...^.^.^.^...^...^.^...^.^.^...^.^.....^.^.^...^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^...^.^.^...^........
.............................................................................................................................................
.......^.^...^.^.^.^.^...^.^.^.^.....^.^...^.^.^.^.^.^...^.^...^.^.^.^.^.^...^.^.^.^.^.......^.^.^.^...^...^.^.^.^.^.^.^.^.^...^...^.^.......
.............................................................................................................................................
......^...^.^.^.^...^.^.^.^.^...^.......^.^...^.^.....^.......^.^.......^...^.^.^...^.....^.^...^.^.^.^.....^.^...^.....^.^.^.^.^.^.^.^......
.............................................................................................................................................
.....^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^...^...^.^.^.^...^.^.^...^.....^.^.^.^.^...^.^.^.^.^.....^.^.^.^.....^...^.^.^.^.^.^.....
.............................................................................................................................................
....^.......^.....^.^...^...^.^.^.^...^.........^.^...........^.^.^.^...^.^.^...^.^.^.^...^.^.^.^...^.^.^...^.^.^.^.^.^.....^.^.^...^.^.^....
.............................................................................................................................................
...^...^...^.^.^.^.^...^...^.^.^.^.^...^.....^...^.^.^.^.^...^.^.^.^...^.^...^...^.....^.^.^.^.^.^.^.^.^.^.^.^...^.......^.^.^.^.^.^...^.^...
.............................................................................................................................................
..^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^...^...^.^...^.^.^.^.^.......^.....^...^.^.^.^.^.^.....^.......^.^...^.^...^...^...^.^..
.............................................................................................................................................
.^...^.^.^.^.^.^...^...^.^...^.^.^...^...^.^...^.^.^...^.^.^.^.^...^...^...^.......^.^...^.^...^.^...^.^...^...^.^.^...^.^.^...^.^.^...^.^.^.
.............................................................................................................................................
`.trim();

// Parse grid
const grid = GRID_RAW.split('\n').map(row => row.split(''));
const HEIGHT = grid.length;
const WIDTH = grid[0].length;

// Find start position
let startX = 0, startY = 0;
for (let y = 0; y < HEIGHT; y++) {
    for (let x = 0; x < WIDTH; x++) {
        if (grid[y][x] === 'S') {
            startX = x;
            startY = y;
        }
    }
}

// Simulation state
let beams = [];          // Active beams: [{x, y, trail: [{x,y}, ...]}]
let hitSplitters = new Set();
let step = 0;
let isPlaying = false;
let animationId = null;
let lastFrameTime = 0;

// Canvas setup
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

function updateCanvasSize() {
    const scale = parseInt(document.getElementById('scale').value);
    canvas.width = WIDTH * scale;
    canvas.height = HEIGHT * scale;
    render();
}

function reset() {
    beams = [{x: startX, y: startY + 1, trail: [{x: startX, y: startY}]}];
    hitSplitters = new Set();
    step = 0;
    updateStats();
    render();
}

function simulateStep() {
    if (beams.length === 0) return false;

    const newBeams = [];

    for (const beam of beams) {
        // Check bounds
        if (beam.x < 0 || beam.x >= WIDTH || beam.y < 0 || beam.y >= HEIGHT) {
            continue; // Beam exits grid
        }

        const cell = grid[beam.y][beam.x];

        if (cell === '^') {
            const key = `${beam.x},${beam.y}`;
            if (!hitSplitters.has(key)) {
                hitSplitters.add(key);
                // Split into two beams going left and right (then continuing down)
                newBeams.push({
                    x: beam.x - 1,
                    y: beam.y,
                    trail: [...beam.trail, {x: beam.x, y: beam.y}]
                });
                newBeams.push({
                    x: beam.x + 1,
                    y: beam.y,
                    trail: [...beam.trail, {x: beam.x, y: beam.y}]
                });
            }
            // Otherwise beam is absorbed
        } else {
            // Continue downward
            newBeams.push({
                x: beam.x,
                y: beam.y + 1,
                trail: [...beam.trail, {x: beam.x, y: beam.y}]
            });
        }
    }

    beams = newBeams;
    step++;
    return beams.length > 0;
}

function render() {
    const scale = parseInt(document.getElementById('scale').value);

    // Clear
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw grid
    for (let y = 0; y < HEIGHT; y++) {
        for (let x = 0; x < WIDTH; x++) {
            const cell = grid[y][x];
            const px = x * scale;
            const py = y * scale;

            if (cell === 'S') {
                ctx.fillStyle = '#00ffcc';
                ctx.fillRect(px, py, scale, scale);
            } else if (cell === '^') {
                const key = `${x},${y}`;
                if (hitSplitters.has(key)) {
                    ctx.fillStyle = '#ff6600'; // Hit splitter
                } else {
                    ctx.fillStyle = '#444'; // Unhit splitter
                }
                ctx.fillRect(px, py, scale, scale);
            }
        }
    }

    // Draw beam trails
    ctx.fillStyle = 'rgba(0, 255, 200, 0.15)';
    for (const beam of beams) {
        for (const pos of beam.trail) {
            ctx.fillRect(pos.x * scale, pos.y * scale, scale, scale);
        }
    }

    // Draw active beam heads with glow
    for (const beam of beams) {
        if (beam.x >= 0 && beam.x < WIDTH && beam.y >= 0 && beam.y < HEIGHT) {
            const px = beam.x * scale + scale/2;
            const py = beam.y * scale + scale/2;

            // Glow effect
            const gradient = ctx.createRadialGradient(px, py, 0, px, py, scale * 2);
            gradient.addColorStop(0, 'rgba(0, 255, 200, 0.8)');
            gradient.addColorStop(0.5, 'rgba(0, 255, 200, 0.3)');
            gradient.addColorStop(1, 'rgba(0, 255, 200, 0)');
            ctx.fillStyle = gradient;
            ctx.fillRect(px - scale * 2, py - scale * 2, scale * 4, scale * 4);

            // Beam head
            ctx.fillStyle = '#00ffcc';
            ctx.fillRect(beam.x * scale, beam.y * scale, scale, scale);
        }
    }
}

function updateStats() {
    document.getElementById('stepCount').textContent = step;
    document.getElementById('beamCount').textContent = beams.length;
    document.getElementById('splitCount').textContent = hitSplitters.size;
}

function gameLoop(timestamp) {
    if (!isPlaying) return;

    const speed = parseInt(document.getElementById('speed').value);
    const delay = 1000 / speed; // Convert speed to delay

    if (timestamp - lastFrameTime >= delay) {
        const hasMore = simulateStep();
        updateStats();
        render();
        lastFrameTime = timestamp;

        if (!hasMore) {
            isPlaying = false;
            document.getElementById('playPause').textContent = 'Play';
            return;
        }
    }

    animationId = requestAnimationFrame(gameLoop);
}

// Event handlers
document.getElementById('playPause').addEventListener('click', () => {
    isPlaying = !isPlaying;
    document.getElementById('playPause').textContent = isPlaying ? 'Pause' : 'Play';
    if (isPlaying) {
        lastFrameTime = 0;
        animationId = requestAnimationFrame(gameLoop);
    }
});

document.getElementById('step').addEventListener('click', () => {
    if (beams.length > 0) {
        simulateStep();
        updateStats();
        render();
    }
});

document.getElementById('reset').addEventListener('click', () => {
    isPlaying = false;
    document.getElementById('playPause').textContent = 'Play';
    if (animationId) cancelAnimationFrame(animationId);
    reset();
});

document.getElementById('scale').addEventListener('input', updateCanvasSize);

// Initialize
updateCanvasSize();
reset();
    </script>
</body>
</html>
